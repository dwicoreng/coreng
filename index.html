<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>CORENG - Lorong Literasi</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<nav>
  <div class="logo">CORENG</div>
  <div>
    <a href="index.html">Beranda</a>
    <a href="puisi.html">Puisi</a>
    <a href="cerpen.html">Cerpen</a>
    <a href="likhati.html">Likhati</a>
    <a href="kirim.html">Kirim Karya</a>
    <a href="penulis.html">Penulis</a>
  </div>
</nav>

<section class="hero">
  <h1>Lorong Literasi</h1>
  <p>Menggores batu-batu dengan kata dan doa sederhana</p>
</section>

<div class="search-box">
  <input type="text" id="searchInput" placeholder="üîé Cari judul, nama, jenis, atau isi karya...">
</div>

<div id="karyaContainer"></div>

<footer>
  ¬© 2026 CORENG - Lorong Literasi
</footer>

<script>
const url = "https://script.google.com/macros/s/AKfycbwAYPlfKkUQk3-uQUC1XUxUQ-3hqDG2qZWuw0vdOc1ZkGpu8BJe0446yNZUBs0yGL9RPw/exec"; // ganti dengan Web App URL
let semuaData = [];

fetch(url+"?action=getKarya")
.then(res=>res.json())
.then(data=>{
  semuaData = data.reverse();
  tampilkan(semuaData);
});

function tampilkan(data){
  let html="";
  data.forEach(d=>{
    html+=`
      <div class="card">
        <img src="${d[9]?d[9]:'default.png'}">
        <div class="card-content">
          <h3>${d[4]}</h3>
          <small>‚úç ${d[3]} | ${d[2]}</small>
          <p>${d[5].substring(0,200)}...</p>
          <div class="card-footer">
            <a href="karya.html?id=${d[0]}">üìñ Baca Selengkapnya</a>
            <button class="like-btn" data-id="${d[0]}">‚ù§Ô∏è <span>${d[10]?d[10]:0}</span></button>
          </div>
        </div>
      </div>
    `;
  });
  document.getElementById("karyaContainer").innerHTML = html;
}

// SEARCH
document.getElementById("searchInput").addEventListener("input", function(){
  const kw = this.value.toLowerCase();
  const hasil = semuaData.filter(d=>d[2].toLowerCase().includes(kw)||d[3].toLowerCase().includes(kw)||d[4].toLowerCase().includes(kw)||d[5].toLowerCase().includes(kw));
  tampilkan(hasil);
});

// LIKE
document.getElementById("karyaContainer").addEventListener("click", function(e){
  if(e.target.classList.contains("like-btn") || e.target.parentElement.classList.contains("like-btn")){
    let btn = e.target.classList.contains("like-btn") ? e.target : e.target.parentElement;
    let idKarya = btn.getAttribute("data-id");
    fetch(url,{method:"POST",body:JSON.stringify({action:"addLike",idKarya:idKarya})})
      .then(res=>res.json())
      .then(res=>{if(res.status=="success") btn.querySelector("span").innerText=res.likes;});
  }
});
</script>

</body>
</html>
