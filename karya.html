<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>CORENG - Baca Karya</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- NAVBAR -->
<nav>
  <div class="logo">CORENG</div>
  <div>
    <a href="index.html">Beranda</a>
    <a href="puisi.html">Puisi</a>
    <a href="cerpen.html">Cerpen</a>
    <a href="likhati.html">Likhati</a>
    <a href="kirim.html">Kirim Karya</a>
    <a href="penulis.html">Penulis</a>
  </div>
</nav>

<!-- KARYA -->
<section id="karyaDetail">
  <h1 id="judul"></h1>
  <small id="meta"></small>
  <p id="isi"></p>
</section>

<!-- KOMENTAR -->
<section id="komentarSection">
  <h2>Komentar</h2>
  <div id="komentarContainer"></div>

  <h3>Tambah Komentar</h3>
  <input type="text" id="namaInput" placeholder="Nama">
  <textarea id="komentarInput" placeholder="Tulis komentar..."></textarea>
  <button id="kirimKomentar">Kirim</button>
</section>

<footer>
  © 2026 CORENG - Portal Literasi Sekolah
</footer>

<script>
const url = "https://script.google.com/macros/s/AKfycbwAYPlfKkUQk3-uQUC1XUxUQ-3hqDG2qZWuw0vdOc1ZkGpu8BJe0446yNZUBs0yGL9RPw/exec"; // GANTI dengan URL Web App

// Ambil ID karya dari query string
const params = new URLSearchParams(window.location.search);
const idKarya = params.get("id");

// Tampilkan karya
fetch(url + "?action=getKarya")
.then(res => res.json())
.then(data => {
  const karya = data.find(d => d[0] == idKarya);
  if(karya){
    document.getElementById("judul").innerText = karya[4];
    document.getElementById("meta").innerText = `✍ ${karya[3]} | ${karya[1]}`;
    document.getElementById("isi").innerText = karya[5];
  } else {
    document.getElementById("karyaDetail").innerHTML = "<p>Karya tidak ditemukan.</p>";
  }
});

// Tampilkan komentar
function loadKomentar(){
  fetch(url + "?action=getKomentar&id=" + idKarya)
  .then(res => res.json())
  .then(data => {
    let html = "";
    data.forEach(k => {
      html += `<div class="komentar-card">
                <strong>${k[1]}</strong> <small>${new Date(k[3]).toLocaleString()}</small>
                <p>${k[2]}</p>
              </div>`;
    });
    if(html=="") html = "<p>Belum ada komentar.</p>";
    document.getElementById("komentarContainer").innerHTML = html;
  });
}

loadKomentar();

// Kirim komentar baru
document.getElementById("kirimKomentar").addEventListener("click", function(){
  const nama = document.getElementById("namaInput").value.trim();
  const komentar = document.getElementById("komentarInput").value.trim();

  if(nama=="" || komentar==""){
    alert("Nama dan komentar harus diisi!");
    return;
  }

  fetch(url, {
    method: "POST",
    body: JSON.stringify({
      action: "addKomentar",
      idKarya: idKarya,
      nama: nama,
      komentar: komentar
    })
  })
  .then(res => res.json())
  .then(res => {
    if(res.status=="success"){
      document.getElementById("namaInput").value = "";
      document.getElementById("komentarInput").value = "";
      loadKomentar(); // refresh komentar
    } else {
      alert("Gagal mengirim komentar.");
    }
  });
});
</script>

</body>
</html>
