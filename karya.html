<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CORENG - Baca Karya</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="style-mobile.css">
</head>
<body>

<nav>
  <div class="logo">CORENG</div>
  <div id="menuToggle">&#9776;</div>
  <div class="menu">
    <a href="index.html">Beranda</a>
    <a href="puisi.html">Puisi</a>
    <a href="cerpen.html">Cerpen</a>
    <a href="likhati.html">Likhati</a>
    <a href="kirim.html">Kirim Karya</a>
    <a href="penulis.html">Penulis</a>
  </div>
</nav>

<section id="karyaDetail" style="max-width:700px;margin:40px auto;">
  <h1 id="judul"></h1>
  <small id="meta"></small>
  <p id="isi"></p>
  <button id="likeKaryaBtn">Like ❤️</button> 
  <span id="likeKaryaCount">0</span> likes
</section>

<section id="komentarSection">
  <h2>Komentar</h2>
  <div id="komentarContainer"></div>

  <h3>Tambah Komentar</h3>
  <input type="text" id="namaInput" placeholder="Nama">
  <textarea id="komentarInput" placeholder="Tulis komentar..."></textarea>
  <button id="kirimKomentar">Kirim</button>
</section>

<footer>© 2026 CORENG - Portal Literasi Sekolah</footer>

<script>
const url = "https://script.google.com/macros/s/AKfycbwAYPlfKkUQk3-uQUC1XUxUQ-3hqDG2qZWuw0vdOc1ZkGpu8BJe0446yNZUBs0yGL9RPw/exec"; // ganti dengan URL Apps Script

const params = new URLSearchParams(window.location.search);
const idKarya = params.get("id");

// ===== Hamburger Menu =====
const menuToggle = document.getElementById("menuToggle");
const menu = document.querySelector("nav .menu");
menuToggle.addEventListener("click", ()=> menu.classList.toggle("show"));

// ===== TAMPILKAN KARYA =====
fetch(url+"?action=getKarya")
.then(res=>res.json())
.then(data=>{
  const karya = data.find(d=>d[0]==idKarya);
  if(karya){
    document.getElementById("judul").innerText=karya[4];
    document.getElementById("meta").innerText=`✍ ${karya[3]} | ${karya[2]}`;
    document.getElementById("isi").innerText=karya[5];
    document.getElementById("likeKaryaCount").innerText = karya[10] || 0;
  } else {
    document.getElementById("karyaDetail").innerHTML="<p>Karya tidak ditemukan.</p>";
  }
});

// ===== LIKE KARYA =====
document.getElementById("likeKaryaBtn").addEventListener("click", ()=>{
  const currentLikes = parseInt(document.getElementById("likeKaryaCount").innerText) || 0;
  fetch(url,{
    method:"POST",
    body:JSON.stringify({action:"addLike", idKarya:idKarya})
  })
  .then(res=>res.json())
  .then(res=>{
    if(res.status=="success"){
      document.getElementById("likeKaryaCount").innerText = res.likes;
    } else alert("Gagal menambahkan like karya.");
  });
});

// ===== KOMENTAR =====
function loadKomentar(){
  fetch(url+"?action=getKomentar&id="+idKarya)
  .then(res=>res.json())
  .then(data=>{
    let html="";
    data.forEach(k=>{
      const likeCount = k[5] || 0;
      const idKomentar = k[6] || new Date().getTime(); // ID komentar unik fallback
      html+=`<div class="komentar-card">
               <strong>${k[1]}</strong> <small>${new Date(k[3]).toLocaleString()}</small>
               <p>${k[2]}</p>
               <button class="like-btn" data-id="${idKomentar}">Like ❤️</button>
               <span class="like-count">${likeCount}</span>
             </div>`;
    });
    if(!html) html="<p>Belum ada komentar.</p>";
    document.getElementById("komentarContainer").innerHTML=html;

    // Tombol like komentar
    document.querySelectorAll(".like-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const idKomentar = btn.dataset.id;
        const likeEl = btn.nextElementSibling;
        const currentLikes = parseInt(likeEl.innerText) || 0;

        fetch(url,{
          method:"POST",
          body:JSON.stringify({action:"likeKomentar", idKomentar: idKomentar})
        })
        .then(res=>res.json())
        .then(res=>{
          if(res.status=="success") loadKomentar();
          else alert("Gagal menambahkan like komentar.");
        });
      });
    });
  });
}

loadKomentar();

// ===== TAMBAH KOMENTAR =====
document.getElementById("kirimKomentar").addEventListener("click", ()=>{
  const nama = document.getElementById("namaInput").value.trim();
  const komentar = document.getElementById("komentarInput").value.trim();
  if(!nama || !komentar){ alert("Nama dan komentar wajib diisi!"); return; }

  fetch(url,{
    method:"POST",
    body:JSON.stringify({action:"addKomentar", idKarya:idKarya, nama:nama, komentar:komentar})
  })
  .then(res=>res.json())
  .then(res=>{
    if(res.status=="success"){
      document.getElementById("namaInput").value="";
      document.getElementById("komentarInput").value="";
      loadKomentar();
    } else alert("Gagal mengirim komentar.");
  });
});
</script>
</body>
</html>
