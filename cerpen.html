<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>CORENG - Cerpen</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<nav>
  <div class="logo">CORENG</div>
  <div>
    <a href="index.html">Beranda</a>
    <a href="puisi.html">Puisi</a>
    <a href="cerpen.html">Cerpen</a>
    <a href="likhati.html">Likhati</a>
    <a href="kirim.html">Kirim Karya</a>
    <a href="penulis.html">Penulis</a>
  </div>
</nav>

<section class="hero">
  <h1>Cerpen</h1>
  <p>Menyelami dunia cerita pendek para penulis muda</p>
</section>

<div class="search-box">
  <input type="text" id="searchInput" placeholder="ğŸ” Cari judul, nama, atau isi cerpen...">
</div>

<div id="karyaContainer"></div>

<footer>
  Â© 2026 CORENG - Portal Literasi Sekolah
</footer>

<script>
const url = "https://script.google.com/macros/s/AKfycbwAYPlfKkUQk3-uQUC1XUxUQ-3hqDG2qZWuw0vdOc1ZkGpu8BJe0446yNZUBs0yGL9RPw/exec"; // Ganti dengan URL Web App
let semuaData = [];

fetch(url + "?action=getKarya")
.then(res => res.json())
.then(data => {
  semuaData = data.filter(d => d[3] === "Cerpen").reverse();
  tampilkan(semuaData);
});

function tampilkan(data){
  let html = "";
  data.forEach(d => {
    html += `
      <div class="card">
        <img src="${d[9] ? d[9] : 'default.png'}">
        <div class="card-content">
          <h3>${d[4]}</h3>
          <small>âœ ${d[3]} | ${d[2]}</small>
          <p>${d[5].substring(0,200)}...</p>
          <div class="card-footer">
            <a href="karya.html?id=${d[0]}">ğŸ“– Baca Selengkapnya</a>
            <button class="like-btn" data-id="${d[0]}">â¤ï¸ <span>${d[10]?d[10]:0}</span></button>
          </div>
        </div>
      </div>
    `;
  });
  document.getElementById("karyaContainer").innerHTML = html;
}

document.getElementById("searchInput").addEventListener("input", function(){
  const keyword = this.value.toLowerCase();
  const hasil = semuaData.filter(d =>
    d[2].toLowerCase().includes(keyword) ||
    d[4].toLowerCase().includes(keyword) ||
    d[5].toLowerCase().includes(keyword)
  );
  tampilkan(hasil);
});

document.getElementById("karyaContainer").addEventListener("click", function(e){
  if(e.target.classList.contains("like-btn") || e.target.parentElement.classList.contains("like-btn")){
    let btn = e.target.classList.contains("like-btn") ? e.target : e.target.parentElement;
    let idKarya = btn.getAttribute("data-id");
    fetch(url,{method:"POST",body:JSON.stringify({action:"addLike",idKarya:idKarya})})
      .then(res=>res.json())
      .then(res=>{if(res.status=="success") btn.querySelector("span").innerText=res.likes;});
  }
});
</script>

</body>
</html>
